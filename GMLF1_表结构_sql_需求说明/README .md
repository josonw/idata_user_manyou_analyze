





# GMLF1：来访业务量分省总量 

l  询条件

| **查询项目** | **控件** | **说明**                  | **格式**                      | **备注**                                                     |
| ------------ | -------- | ------------------------- | ----------------------------- | ------------------------------------------------------------ |
| 时间维度     | 下拉框   | 年/月/周/日               | char                          | 年/月/周/日                                                  |
| 开始时间     | 日历     | 按日查   询               | YYYY/YYYYMM/YYYYMM-W/YYYYMMDD | 系统提供日历，默认值为系统当前日期                           |
| 结束时间     | 日历     | 按日查询                  | YYYY/YYYYMM/YYYYMM-W/YYYYMMDD | 系统提供日历，默认值为系统当前日期                           |
| 业务类型     | 下拉框   | 默认选择全部              | char                          | 短信业务、数据业务、语音业务；   全部                        |
| 国家地区     | 下拉框   |                           | char                          | 默认为全部                                                   |
| 运营商       | 下拉框   |                           | char                          | 默认为全部，若已选择国家地区，则对应列出该国家地区下的全部运营商。 |
| 业务线       | 下拉框   | 国际出访,国际来访,国际IDD | char                          | ,国际来访                                                    |

 

 

l  取数规则

取数表与QGST5相同，对省分类并筛选，仅仅展示查询账号所属省的数据，选取来访业务量分省总量；

| **展示项** | **数据来源**                                                 | **逻辑算法**                                                 |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 用户数     | iigsmdba.cdr_gsm   iidualdba.cdr_gsm   iigsmdba.cdr_gprs   iidualdba.cdr_gprs | 根据时间段、业务类型,累计用户数。字段imsi代表用户。          |
| 话单量     | iigsmdba.cdr_gsm   iidualdba.cdr_gsm   iigsmdba.cdr_gprs   iidualdba.cdr_gprs | 根据时间段、业务类型,累计话单量。                            |
| 业务量     | iigsmdba.cdr_gsm   iidualdba.cdr_gsm   iigsmdba.cdr_gprs   iidualdba.cdr_gprs | 根据时间段、业务类型,累计业务量。根据时间段累计各个方向业务量，排序输出TOP10；若选择全部，则按照话单量排序。 |
| 环比增长率 | 计算得出                                                     | （本期数值-上期数值）/上期数值*100%                          |
| 同比增长率 | 计算得出                                                     | （当年值-去年同期值）÷去年同期值*100%                        |

 



##  需求分析：

周环比同比

一周的时间段的区分，date_sub(next_day(sttl_dt,'MO'),7)  是这周的时间就同一标记这周的周一日期

通过 concat(substr(date_sub(next_day(sttl_dt,'MO'),4),0,4),weekofyear(sttl_dt)) 标上 是这年的第几周

总的：需要求出环比、和同比的  数据

hive 和mysql 不建立最后的结果百分比，hive表给出 本期、上期、去年同期的数据，数据同步到mysql 取数   x/x=100*100 拼接上%

hive的表设计，sum 本期的金额，是用的中间表就是本期要求的金额，left join 结果表，用nvl来取上期和去年同期，在第一次的时候可以把nvl的数据全补零把每个时间的金额sum补齐，最后在选择一个时间点开始取上期、去年同期的数据

a.sum,
nvl(c.sum,0) as last_years_sum,
nvl(b.sum,0) as last_sum,

on substr(add_months(concat(a.datas,'-01'),-1),0,7) = b.sttl_dt 

on substr(add_months(concat(a.datas,'-01'),-12),0,7) = c.sttl_dt



一个分类的业务指标语音、话单、短信、各个业务指标的具体情况，然后哪个指标要全部的就 不已这个指标分类并打上‘’全部‘的指标，这个指标不加入分组的条件，然后 union all 



## 问题



## 需求展示

展示项目：业务类型、开始时间、结束时间、国家地区、运营商、用户数、用户数环比增长率、用户数同比增长率、话单量、话单量环比增长率、话单量同比增长率、业务量、业务量环比增长率、业务量同比增长率。

增长率保留小数点后2位。