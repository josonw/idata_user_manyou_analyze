





# TSYH2：携转用户国漫出访情况

l  查询条件

| **序号** | **查询项** | **说明**                                                     |
| -------- | ---------- | ------------------------------------------------------------ |
| 1        | 时间单位   | 下拉框，可选：日、月、年。                                   |
| 2        | 查询时间   | 时间段选择框；精确到yyyy:mm:dd                               |
| 3        | 运营商     | 下拉框，可选：全部、各运营商。支持多选。默认全部，支持模糊搜索 |
| 4        | 国家及地区 | 下拉框，可选：全部、各国家及地区。支持多选。默认全部，支持模糊搜索 |

 

l  取数规则

（1）根据携号转网话单分拣审计表、根据查询条件筛选出在选择的时间段的短信用户量、短信话单量、语音用户量、语音话单量、数据话单量、数据用户量。

补充说明：

（1）用户量去重，时间单位为日，当天内去重。时间单位为月，改月内去重。

（2）业务包括：自动漫游、漫游伴侣、一卡多号。

（3）数据话单以GGSN文件为准，语音、短信话单以TAP文件为准。

（4）用户量占比=国漫携转用户量/国漫用户量。

（5）话单占比=国漫携转用户话单量/国漫用户量。

（6）用户量合计：各业务用户量去重相加。

（7）话单量合计：各业务话单量相加。

统计口径，主要包括：

| **字段**         | **相关表**                                 | **统计口径**                                                 | **大数据平台相关表**                                 |
| ---------------- | ------------------------------------------ | ------------------------------------------------------------ | ---------------------------------------------------- |
| 语音用户量及占比 | 语音iogsmdba.cdr_gsm；iodualdba.cdr_gsm;   | （1）省侧该时间段内出境漫游的语音携转用户；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，serv_cdin(11,12)，count(distinct(imsi))   （2）省侧该时间段内出境漫游的语音用户；   =’筛选的时间’，prov_cd=’省代码’，count(distinct(imsi)   （3）语音用户量占比=出境漫游的语音携转用户/出境漫游的语音用户*100%。 | DWD_GSM_IOGSMDBA_CDR_GSM   DWD_GSM_IODUALDBA_CDR_GSM |
| 语音话单及占比   | 语音：iogsmdba.cdr_gsm；iodualdba.cdr_gsm; | （1）省侧该时间段内出境漫游的携转用户语音话单量；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，serv_cd in(11,12)，count(*)   （2）省侧该时间段内出境漫游的语音话单量；   =’筛选的时间’，prov_cd=’省代码’，count(*)   （3）语音话单量占比=出境漫游的携转用户语音话单量/出境漫游的语音话单量*100%。 | DWD_GSM_IOGSMDBA_CDR_GSM   DWD_GSM_IODUALDBA_CDR_GSM |
| 短信用户量及占比 | 短信iogsmdba.cdr_gsm；iodualdba.cdr_gsm;   | （1）省侧该时间段内出境漫游的短信携转用户；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，serv_cd in(21,22)，count(distinct(imsi))   （2）省侧该时间段内出境漫游的短信用户；   =’筛选的时间’，prov_cd=’省代码’，count(distinct(imsi)   （3）语音用户量占比=出境漫游的短信携转用户/出境漫游的短信用户*100%。 | DWD_GSM_IOGSMDBA_CDR_GSM   DWD_GSM_IODUALDBA_CDR_GSM |
| 短信话单量及占比 | 短信：iogsmdba.cdr_gsm；iodualdba.cdr_gsm; | （1）省侧该时间段内出境漫游的携转用户短信话单量；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，serv_cd in(21,22)，count(*)   （2）省侧该时间段内出境漫游的短信话单量；   =’筛选的时间’，prov_cd=’省代码’，count(*)   （3）短信话单量占比=出境漫游的携转用户短信话单量/出境漫游的短信话单量*100%。 | DWD_GSM_IOGSMDBA_CDR_GSM   DWD_GSM_IODUALDBA_CDR_GSM |
| 数据用户量及占比 | 数据：ioggsndba.gp_cdr                     | （1）省侧该时间段内出境漫游的数据携转用户；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，count(distinct(imsi))   （2）省侧该时间段内出境漫游的数据用户；   =’筛选的时间’，prov_cd=’省代码’，count(distinct(imsi)   （3）语音用户量占比=出境漫游的数据携转用户/出境漫游的数据用户*100%。 | DWD_GGSN_NRTDBA_GP_CDR                               |
| 数据话单量及占比 | 数据：ioggsndba.gp_cdr                     | （1）省侧该时间段内出境漫游的携转用户数据话单量；   =’筛选的时间’，IMSI like ‘460076%’prov_cd=’省代码’，count(*)   （2）省侧该时间段内出境漫游的数据话单量；   =’筛选的时间’，prov_cd=’省代码’，count(*)   （3）数据话单量占比=出境漫游的携转用户数据话单量/出境漫游的数据话单量*100%。 | DWD_GGSN_NRTDBA_GP_CDR                               |

 





##  需求分析：



语音用户量机占比、语音话单量及占比、短信用户量及占比、短信话单量及占比，这几个需求都是用到了DWD_GSM_IOGSMDBA_CDR_GSM
DWD_GSM_IODUALDBA_CDR_GSM这两个表，

数据用户量及占比、数据话单量及占比都是用到了DWD_GGSN_NRTDBA_GP_CDR这个表，

几个量的需求的条件是不一样的，所以这个边的想法是把以上的三个表的数据全部 union all 起来因为都是用的三个表中的 imsis这个字段统计

在求具体的哪个量的时候用 case when xx then xx end 分别求出各个量的数据，

其中两个表用serv_cd来过滤数据，

然后只有用到一个表的那个数据serv_cd就把这个字段 变成标识‘x’ 最后用到这个表的数据的时候

case when  serv_cd=‘x’ and  跟上其他的过滤条件

这样就把三个表的数据和并并且要用到哪个表的数据的时候就在

case when  中进行过滤

## 问题

是否有效率问题！待考虑

## 需求展示

